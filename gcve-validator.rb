#!/usr/bin/env ruby
require 'json'
require 'json-schema'
require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: validate_json.rb -s SCHEMA -j JSON"

  opts.on("-s", "--schema SCHEMA", "Path to JSON Schema file") do |s|
    options[:schema] = s
  end

  opts.on("-r", "--read JSON", "Path to JSON file to validate") do |r|
    options[:json] = r
  end
end.parse!

unless options[:schema] && options[:json]
  puts "Both schema and JSON files are required."
  puts "Usage: validate_json.rb -s SCHEMA -j JSON"
  exit 1
end

begin
  schema = JSON.parse(File.read(options[:schema]))
  data   = JSON.parse(File.read(options[:json]))

  JSON::Validator.validate!(schema, data)
  puts "[*] Hooray, you didn't bork it up!"
rescue JSON::Schema::ValidationError => e
  puts "[-] Dang: #{e.message}"
  exit 2
rescue JSON::ParserError => e
  puts "[-] Dang: #{e.message}"
  exit 3
end
